<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Interview - AI Interview Coach</title>
  <meta name="description" content="Try our AI-powered interview coaching system with real-time feedback">
  <meta name="keywords" content="AI interview, mock interview, interview practice, AI feedback">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
    .demo-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .video-container {
      position: relative;
      background: #000;
      border-radius: 15px;
      overflow: hidden;
      aspect-ratio: 16/9;
      margin-bottom: 1rem;
    }
    
    .video-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .user-video {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .ai-video {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .video-label {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
    }
    
    /* AI Avatar Styles */
    .ai-interviewer {
      text-align: center;
      color: white;
    }
    
    .ai-avatar {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
    }
    
    .ai-face {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      margin: 0 auto;
      position: relative;
      border: 3px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }
    
    .ai-eye {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 25px;
      animation: blink 3s infinite;
    }
    
    .left-eye {
      left: 20px;
    }
    
    .right-eye {
      right: 20px;
    }
    
    .ai-mouth {
      width: 20px;
      height: 10px;
      border: 2px solid white;
      border-top: none;
      border-radius: 0 0 20px 20px;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      animation: talk 2s infinite;
    }
    
    /* Speaking Animation */
    .speaking-indicator {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2px;
    }
    
    .wave {
      width: 3px;
      height: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 2px;
      animation: wave 1s infinite;
    }
    
    .wave1 { animation-delay: 0s; }
    .wave2 { animation-delay: 0.1s; }
    .wave3 { animation-delay: 0.2s; }
    .wave4 { animation-delay: 0.3s; }
    
    /* Animations */
    @keyframes blink {
      0%, 90%, 100% { transform: scaleY(1); }
      95% { transform: scaleY(0.1); }
    }
    
    @keyframes talk {
      0%, 100% { transform: translateX(-50%) scaleY(1); }
      50% { transform: translateX(-50%) scaleY(1.5); }
    }
    
    @keyframes wave {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(2); }
    }
    
    .analysis-panel {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .metric-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #667eea;
    }
    
    .metric-value {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
    }
    
    .start-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 1rem 2rem;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    /* Speaking state */
    .ai-video.speaking .wave {
      animation-duration: 0.5s;
    }
    
    .ai-video.speaking .ai-mouth {
      animation-duration: 0.8s;
    }
    
    /* Question and Answer Panels */
    .question-panel, .answer-panel {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      height: 100%;
      margin-bottom: 2rem;
    }
    
    .panel-title {
      font-weight: 600;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #f8f9fa;
    }
    
    .question-content, .answer-content {
      min-height: 120px;
    }
    
    .current-question {
      font-size: 1.1rem;
      font-style: italic;
      color: #2c3e50;
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 10px;
      border-left: 4px solid #28a745;
      margin: 0;
    }
    
    .user-answer {
      font-size: 1rem;
      color: #495057;
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 10px;
      border-left: 4px solid #007bff;
      margin: 0 0 1rem 0;
      min-height: 80px;
    }
    
    .answer-timer {
      text-align: right;
    }
    
    .timer {
      font-weight: 600;
      color: #007bff;
    }
    
    /* Interview Controls */
    .interview-controls {
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    
    .btn-outline-primary, .btn-outline-danger {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
    }
    
    /* Authentication loading screen */
    .auth-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(-45deg, #0ea5e9, #06b6d4, #10b981, #059669);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: white;
      text-align: center;
      font-family: 'Inter', sans-serif;
    }
    
    .auth-loading.hidden {
      display: none;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .loading-content h2 {
      margin-bottom: 20px;
      font-size: 2rem;
      font-weight: 600;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body class="demo-page">


  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">AI Interview Coach</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#about">About</a></li>
          <li><a href="index.html#features">Features</a></li>
          <li><a href="#" class="active">Interview</a></li>
          <li><a href="index.html#contact">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <a class="btn-getstarted" href="index.html">Back to Home</a>

    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container">
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Interview Demo</li>
          </ol>
        </nav>
        <h1>AI Interview Demo</h1>
        <p>Experience our AI-powered interview coaching system</p>
      </div>
    </div><!-- End Page Title -->

    <!-- Demo Section -->
    <section id="demo" class="demo section">
      <div class="container">
        <div class="demo-container">
          
          <div class="row">
            <div class="col-lg-6">
              <!-- User Video Container -->
              <div class="video-container mb-3">
                <div class="video-placeholder user-video">
                  <div class="text-center">
                    <i class="bi bi-camera-video" style="font-size: 4rem; margin-bottom: 1rem;"></i>
                    <h3>Your Camera</h3>
                    <p>Click start to begin your mock interview</p>
                    <button class="start-btn">
                      <i class="bi bi-play-fill me-2"></i>
                      Start Interview
                    </button>
                  </div>
                </div>
                <div class="video-label">
                  <span class="badge bg-primary">You</span>
                </div>
              </div>
            </div>
            
            <div class="col-lg-6">
              <!-- AI Interviewer Video Container -->
              <div class="video-container mb-3">
                <div class="video-placeholder ai-video">
                  <div class="ai-interviewer">
                    <div class="ai-avatar">
                      <div class="ai-face">
                        <div class="ai-eye left-eye"></div>
                        <div class="ai-eye right-eye"></div>
                        <div class="ai-mouth"></div>
                      </div>
                      <div class="speaking-indicator">
                        <div class="wave wave1"></div>
                        <div class="wave wave2"></div>
                        <div class="wave wave3"></div>
                        <div class="wave wave4"></div>
                      </div>
                    </div>
                    <h4 class="mt-3">AI Interviewer</h4>
                    <p class="ai-status">Ready to start interview</p>
                  </div>
                </div>
                <div class="video-label">
                  <span class="badge bg-success">AI Assistant</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Interview Controls -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="interview-controls text-center">
                <button class="btn btn-outline-primary me-2">
                  <i class="bi bi-mic"></i> Microphone
                </button>
                <button class="btn btn-outline-primary me-2">
                  <i class="bi bi-camera-video"></i> Camera
                </button>
                <button class="btn btn-outline-danger">
                  <i class="bi bi-stop-fill"></i> End Interview
                </button>
              </div>
            </div>
          </div>
          
          <!-- Question and Answer Section -->
          <div class="row">
            <div class="col-lg-6">
              <div class="question-panel">
                <h5 class="panel-title">
                  <i class="bi bi-chat-quote text-success me-2"></i>
                  Current Question
                </h5>
                <div class="question-content">
                  <p class="current-question">"Tell me about yourself and your background."</p>
                </div>
              </div>
            </div>
            
            <div class="col-lg-6">
              <div class="answer-panel">
                <h5 class="panel-title">
                  <i class="bi bi-mic text-primary me-2"></i>
                  Your Answer
                </h5>
                <div class="answer-content">
                  <p class="user-answer">Listening for your response...</p>
                  <div class="answer-timer">
                    <small class="text-muted">Response time: <span class="timer">0:00</span></small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="row mt-5">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">
                    <i class="bi bi-lightbulb text-warning me-2"></i>
                    How It Works
                  </h5>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="text-center p-3">
                        <i class="bi bi-camera-video text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">Video Analysis</h6>
                        <p class="small text-muted">AI analyzes facial expressions, eye contact, and body language</p>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="text-center p-3">
                        <i class="bi bi-mic text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">Voice Processing</h6>
                        <p class="small text-muted">Speech patterns, tone, and clarity are evaluated in real-time</p>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="text-center p-3">
                        <i class="bi bi-brain text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">AI Feedback</h6>
                        <p class="small text-muted">Comprehensive analysis and personalized improvement suggestions</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer id="footer" class="footer position-relative dark-background">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">AI Interview Coach</span>
          </a>
          <p>Master your interview skills with our AI-powered coaching platform that provides real-time feedback on facial expressions, voice tone, and communication skills.</p>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Navigation</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#features">Features</a></li>
            <li><a href="#">Demo</a></li>
            <li><a href="index.html#contact">Contact</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Features</h4>
          <ul>
            <li><a href="index.html#features">Facial Analysis</a></li>
            <li><a href="index.html#features">Voice Analysis</a></li>
            <li><a href="index.html#features">Language Processing</a></li>
            <li><a href="index.html#features">Performance Report</a></li>
            <li><a href="#">AI Feedback</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>A108 Adam Street</p>
          <p>New York, NY 535022</p>
          <p>United States</p>
          <p class="mt-4"><strong>Phone:</strong> <span>+1 5589 55488 55</span></p>
          <p><strong>Email:</strong> <span>info@aiinterviewcoach.com</span></p>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">AI Interview Coach</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Powered by Advanced AI Technology
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <script>
    // Global variables
    let videoStream = null;
    let analysisInterval = null;
    let canvas = null;
    let ctx = null;
    let currentAnalysis = null;
    let emotionHistory = [];
    
    document.addEventListener('DOMContentLoaded', function() {
      initializeInterviewPage();
    });
    
    function initializeInterviewPage() {
      const startBtn = document.querySelector('.start-btn');
      const userVideoPlaceholder = document.querySelector('.user-video');
      const aiVideoPlaceholder = document.querySelector('.ai-video');
      const aiStatus = document.querySelector('.ai-status');
      const currentQuestion = document.querySelector('.current-question');
      const userAnswer = document.querySelector('.user-answer');
      const timer = document.querySelector('.timer');
      
      // Create hidden canvas for frame capture
      canvas = document.createElement('canvas');
      ctx = canvas.getContext('2d');
      
      const questions = [
        "Tell me about yourself and your background.",
        "What are your greatest strengths?",
        "Describe a challenging situation you faced at work.",
        "Where do you see yourself in 5 years?",
        "Why do you want to work for our company?"
      ];
      
      let currentQuestionIndex = 0;
      let interviewActive = false;
      let responseTimer = 0;
      let timerInterval;
      
      startBtn.addEventListener('click', function() {
        if (!interviewActive) {
          requestCameraPermission();
        }
      });
      
      function checkCameraSupport() {
        // Check if we're on HTTPS or localhost
        const isSecureContext = window.isSecureContext || 
                               location.protocol === 'https:' || 
                               location.hostname === 'localhost' || 
                               location.hostname === '127.0.0.1';
        
        if (!isSecureContext) {
          showHTTPSRequired();
          return false;
        }
        
        // Check if navigator exists
        if (!navigator) {
          return false;
        }
        
        // Check for modern getUserMedia
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          return true;
        }
        
        // Check for legacy getUserMedia
        if (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
          return true;
        }
        
        return false;
      }
      
      function showHTTPSRequired() {
        userVideoPlaceholder.innerHTML = `
          <div class="text-center text-warning">
            <i class="bi bi-shield-exclamation" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h4>HTTPS Required for Camera Access</h4>
            <p>Modern browsers require HTTPS to access the camera for security reasons.</p>
            <div style="text-align: left; display: inline-block; margin: 20px 0;">
              <p><strong>Quick Solutions:</strong></p>
              <ul>
                <li><strong>Option 1:</strong> Access via HTTPS: <br>
                    <code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">
                      https://localhost:8443
                    </code>
                </li>
                <li><strong>Option 2:</strong> Start server with HTTPS: <br>
                    <code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">
                      ./run.sh --https
                    </code>
                </li>
                <li><strong>Option 3:</strong> Use Chrome with flag: <br>
                    <code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">
                      --unsafely-treat-insecure-origin-as-secure=http://localhost:8000
                    </code>
                </li>
              </ul>
            </div>
            <div class="mt-3">
              <button class="btn btn-primary me-2" onclick="window.location.href='https://localhost:8443'">
                <i class="bi bi-shield-check me-2"></i>Switch to HTTPS
              </button>
              <button class="btn btn-outline-secondary" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise me-2"></i>Retry
              </button>
            </div>
          </div>
        `;
      }
      
      function showBrowserCompatibilityError() {
        userVideoPlaceholder.innerHTML = `
          <div class="text-center text-danger">
            <i class="bi bi-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h4>Browser Not Compatible</h4>
            <p>Your browser doesn't support camera access or you're not using HTTPS.</p>
            <div style="text-align: left; display: inline-block; margin: 20px 0;">
              <p><strong>To fix this issue:</strong></p>
              <ul>
                <li>Make sure you're using a modern browser (Chrome, Firefox, Safari, Edge)</li>
                <li>Ensure the website is served over HTTPS (not HTTP)</li>
                <li>Check if your browser has camera permissions enabled</li>
                <li>Try accessing the site in an incognito/private window</li>
              </ul>
            </div>
            <div class="mt-3">
              <button class="btn btn-primary me-2" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise me-2"></i>Retry
              </button>
              <button class="btn btn-outline-info" onclick="window.open('https://caniuse.com/stream', '_blank')">
                <i class="bi bi-info-circle me-2"></i>Check Browser Support
              </button>
            </div>
          </div>
        `;
      }
      
      async function requestCameraPermission() {
        // Check if getUserMedia is supported
        if (!checkCameraSupport()) {
          showBrowserCompatibilityError();
          return;
        }
        
        // Show permission request modal
        const permissionModal = document.createElement('div');
        permissionModal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 2000;
        `;
        
        permissionModal.innerHTML = `
          <div style="
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
          ">
            <i class="bi bi-camera-video" style="font-size: 4rem; color: #667eea; margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 20px; color: #333;">Camera Permission Required</h3>
            <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
              This AI-powered interview requires camera access to analyze your facial expressions 
              and provide real-time feedback. Your privacy is protected - no video is recorded or stored.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
              <button id="allow-camera" class="btn btn-primary" style="padding: 12px 30px;">
                <i class="bi bi-check-circle me-2"></i>Allow Camera
              </button>
              <button id="deny-camera" class="btn btn-outline-secondary" style="padding: 12px 30px;">
                <i class="bi bi-x-circle me-2"></i>Cancel
              </button>
            </div>
          </div>
        `;
        
        document.body.appendChild(permissionModal);
        
        // Handle permission responses
        document.getElementById('allow-camera').addEventListener('click', async () => {
          permissionModal.remove();
          await startInterview();
        });
        
        document.getElementById('deny-camera').addEventListener('click', () => {
          permissionModal.remove();
          showPermissionDeniedMessage();
        });
      }
      
      function showPermissionDeniedMessage() {
        userVideoPlaceholder.innerHTML = `
          <div class="text-center text-warning">
            <i class="bi bi-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h4>Camera Permission Required</h4>
            <p>To use the AI interview feature, please allow camera access.</p>
            <p><small>Your privacy is protected - no video is recorded or stored.</small></p>
            <button class="btn btn-primary mt-3" onclick="location.reload()">
              <i class="bi bi-camera-video me-2"></i>Try Again
            </button>
          </div>
        `;
      }
      
      async function getCameraStream() {
        const constraints = { 
          video: { 
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }, 
          audio: true 
        };
        
        // Try modern getUserMedia first
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          return await navigator.mediaDevices.getUserMedia(constraints);
        }
        
        // Fallback to legacy getUserMedia
        const getUserMedia = navigator.getUserMedia || 
                            navigator.webkitGetUserMedia || 
                            navigator.mozGetUserMedia;
        
        if (getUserMedia) {
          return new Promise((resolve, reject) => {
            getUserMedia.call(navigator, constraints, resolve, reject);
          });
        }
        
        throw new Error('getUserMedia is not supported in this browser');
      }
      
      async function startInterview() {
        interviewActive = true;
        
        // Show loading state
        userVideoPlaceholder.innerHTML = `
          <div class="text-center">
            <div class="spinner-border text-light mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <h4>Connecting to Camera...</h4>
            <p>Please wait while we set up your interview</p>
          </div>
        `;
        
        try {
          // Request camera access with fallbacks
          videoStream = await getCameraStream();
          
          // Create video element
          const video = document.createElement('video');
          video.srcObject = videoStream;
          video.autoplay = true;
          video.muted = true;
          video.style.width = '100%';
          video.style.height = '100%';
          video.style.objectFit = 'cover';
          
          // Replace placeholder with video
          userVideoPlaceholder.innerHTML = '';
          userVideoPlaceholder.appendChild(video);
          
          // Add analysis overlay
          const analysisOverlay = document.createElement('div');
          analysisOverlay.style.cssText = `
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 100;
          `;
          analysisOverlay.id = 'analysis-overlay';
          userVideoPlaceholder.style.position = 'relative';
          userVideoPlaceholder.appendChild(analysisOverlay);
          
          // Start DeepFace analysis
          video.addEventListener('loadedmetadata', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            startFacialAnalysis(video);
          });
          
          // Activate AI interviewer
          aiStatus.textContent = "Asking question...";
          aiVideoPlaceholder.classList.add('speaking');
          
          // Start question cycle
          setTimeout(() => {
            askNextQuestion();
          }, 2000);
          
        } catch (error) {
          console.error('Error accessing camera:', error);
          
          let errorMessage = '';
          let errorIcon = 'bi-exclamation-triangle';
          
          if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
            errorMessage = `
              <h4>Camera Permission Denied</h4>
              <p>Please allow camera access to continue with the interview.</p>
              <p><small>To enable camera:</small></p>
              <ul style="text-align: left; display: inline-block;">
                <li>Click the camera icon in your browser's address bar</li>
                <li>Select "Allow" for camera access</li>
                <li>Refresh the page and try again</li>
              </ul>
            `;
          } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
            errorMessage = `
              <h4>No Camera Found</h4>
              <p>Please connect a camera device to continue.</p>
              <p><small>Make sure your camera is properly connected and not being used by another application.</small></p>
            `;
            errorIcon = 'bi-camera-video-off';
          } else if (error.name === 'NotSupportedError') {
            errorMessage = `
              <h4>Camera Not Supported</h4>
              <p>Your browser doesn't support camera access.</p>
              <p><small>Please try using Chrome, Firefox, or Safari.</small></p>
            `;
            errorIcon = 'bi-browser-chrome';
          } else {
            errorMessage = `
              <h4>Camera Access Error</h4>
              <p>Unable to access your camera. Please check your settings.</p>
              <p><small>Error: ${error.message}</small></p>
            `;
          }
          
          userVideoPlaceholder.innerHTML = `
            <div class="text-center text-danger">
              <i class="${errorIcon}" style="font-size: 3rem; margin-bottom: 1rem;"></i>
              ${errorMessage}
              <div class="mt-3">
                <button class="btn btn-primary me-2" onclick="location.reload()">
                  <i class="bi bi-arrow-clockwise me-2"></i>Retry
                </button>
                <button class="btn btn-outline-secondary" onclick="requestCameraPermission()">
                  <i class="bi bi-camera-video me-2"></i>Request Permission
                </button>
              </div>
            </div>
          `;
          
          // Reset interview state
          interviewActive = false;
        }
      }
      
      function startFacialAnalysis(video) {
        analysisInterval = setInterval(async () => {
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            try {
              // Capture frame
              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
              const imageData = canvas.toDataURL('image/jpeg', 0.8);
              
              // Send to DeepFace API
              const response = await fetch('/api/analyze-frame', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  image: imageData,
                  session_id: 'interview_session'
                })
              });
              
              if (response.ok) {
                const analysis = await response.json();
                updateAnalysisDisplay(analysis);
                emotionHistory.push({
                  timestamp: Date.now(),
                  emotion: analysis.emotion,
                  confidence: analysis.confidence
                });
                
                // Keep only last 10 emotions
                if (emotionHistory.length > 10) {
                  emotionHistory.shift();
                }
              }
            } catch (error) {
              console.error('Analysis error:', error);
            }
          }
        }, 2000); // Analyze every 2 seconds
      }
      
      function updateAnalysisDisplay(analysis) {
        const overlay = document.getElementById('analysis-overlay');
        if (overlay && analysis.success) {
          overlay.innerHTML = `
            <div><strong>Emotion:</strong> ${analysis.emotion}</div>
            <div><strong>Age:</strong> ~${Math.round(analysis.age)}</div>
            <div><strong>Gender:</strong> ${analysis.gender}</div>
            <div><strong>Confidence:</strong> ${(analysis.confidence * 100).toFixed(1)}%</div>
          `;
          
          // Update emotion feedback
          if (analysis.emotion !== 'unknown') {
            getFeedback(analysis.emotion, analysis.confidence);
          }
        }
      }
      
      async function getFeedback(emotion, confidence) {
        try {
          const response = await fetch('/api/get-feedback', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              emotion: emotion,
              confidence: confidence
            })
          });
          
          if (response.ok) {
            const feedback = await response.json();
            displayFeedback(feedback);
          }
        } catch (error) {
          console.error('Feedback error:', error);
        }
      }
      
      function displayFeedback(feedback) {
        // Create or update feedback panel
        let feedbackPanel = document.getElementById('emotion-feedback');
        if (!feedbackPanel) {
          feedbackPanel = document.createElement('div');
          feedbackPanel.id = 'emotion-feedback';
          feedbackPanel.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 2px solid ${feedback.color || 'blue'};
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
          `;
          document.body.appendChild(feedbackPanel);
        }
        
        feedbackPanel.innerHTML = `
          <div style="color: ${feedback.color || 'blue'}; font-weight: bold; margin-bottom: 8px;">
            <i class="bi bi-lightbulb"></i> AI Feedback
          </div>
          <div style="margin-bottom: 8px;">${feedback.message}</div>
          <div style="font-size: 12px; color: #666;">${feedback.suggestion}</div>
        `;
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
          if (feedbackPanel) {
            feedbackPanel.style.opacity = '0.5';
          }
        }, 5000);
      }
      
      function askNextQuestion() {
        if (currentQuestionIndex < questions.length) {
          // AI speaks
          aiStatus.textContent = "Speaking...";
          aiVideoPlaceholder.classList.add('speaking');
          
          // Update question text with typing effect
          typeQuestion(questions[currentQuestionIndex]);
          
          // Reset answer section
          userAnswer.textContent = "Listening for your response...";
          resetTimer();
          
          setTimeout(() => {
            // AI stops speaking and waits for response
            aiStatus.textContent = "Listening to your response...";
            aiVideoPlaceholder.classList.remove('speaking');
            
            // Start response timer
            startResponseTimer();
            
            // Next question after 15 seconds
            setTimeout(() => {
              currentQuestionIndex++;
              askNextQuestion();
            }, 15000);
          }, 3000);
        } else {
          // Interview complete
          endInterview();
        }
      }
      
      function endInterview() {
        aiStatus.textContent = "Interview completed!";
        aiVideoPlaceholder.classList.remove('speaking');
        currentQuestion.textContent = "Thank you for completing the interview. Generating your report...";
        userAnswer.textContent = "Interview session completed. Thank you for your time!";
        clearInterval(timerInterval);
        clearInterval(analysisInterval);
        
        // Stop camera
        if (videoStream) {
          videoStream.getTracks().forEach(track => track.stop());
        }
        
        // Show emotion summary
        showEmotionSummary();
      }
      
      function showEmotionSummary() {
        if (emotionHistory.length > 0) {
          const emotionCounts = {};
          emotionHistory.forEach(item => {
            emotionCounts[item.emotion] = (emotionCounts[item.emotion] || 0) + 1;
          });
          
          const dominantEmotion = Object.keys(emotionCounts)
            .reduce((a, b) => emotionCounts[a] > emotionCounts[b] ? a : b);
          
          const summaryPanel = document.createElement('div');
          summaryPanel.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            max-width: 400px;
            text-align: center;
          `;
          
          summaryPanel.innerHTML = `
            <h3 style="color: #667eea; margin-bottom: 20px;">Interview Summary</h3>
            <p><strong>Dominant Emotion:</strong> ${dominantEmotion}</p>
            <p><strong>Total Emotions Detected:</strong> ${emotionHistory.length}</p>
            <div style="margin-top: 20px;">
              <button class="btn btn-primary" onclick="this.parentElement.parentElement.remove()">
                Close Summary
              </button>
            </div>
          `;
          
          document.body.appendChild(summaryPanel);
        }
      }
      
      function typeQuestion(question) {
        let i = 0;
        currentQuestion.textContent = "";
        const typingSpeed = 50;
        
        function type() {
          if (i < question.length) {
            currentQuestion.textContent += question.charAt(i);
            i++;
            setTimeout(type, typingSpeed);
          }
        }
        type();
      }
      
      function startResponseTimer() {
        responseTimer = 0;
        timerInterval = setInterval(() => {
          responseTimer++;
          const minutes = Math.floor(responseTimer / 60);
          const seconds = responseTimer % 60;
          timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }
      
      function resetTimer() {
        clearInterval(timerInterval);
        responseTimer = 0;
        timer.textContent = "0:00";
      }
      
      // Add click to restart functionality
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('btn-outline-danger')) {
          endInterview();
          
          // Reset interview
          interviewActive = false;
          currentQuestionIndex = 0;
          clearInterval(timerInterval);
          clearInterval(analysisInterval);
          
          if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
          }
          
          userVideoPlaceholder.innerHTML = `
            <div class="text-center">
              <i class="bi bi-camera-video" style="font-size: 4rem; margin-bottom: 1rem;"></i>
              <h3>Your Camera</h3>
              <p>Click start to begin your mock interview</p>
              <button class="start-btn">
                <i class="bi bi-play-fill me-2"></i>
                Start Interview
              </button>
            </div>
          `;
          
          aiStatus.textContent = "Ready to start interview";
          aiVideoPlaceholder.classList.remove('speaking');
          currentQuestion.textContent = '"Tell me about yourself and your background."';
          userAnswer.textContent = "Listening for your response...";
          resetTimer();
          
          // Re-attach event listener to new start button
          const newStartBtn = document.querySelector('.start-btn');
          newStartBtn.addEventListener('click', function() {
            if (!interviewActive) {
              startInterview();
            }
          });
        }
      });
    } // End of initializeInterviewPage function
  </script>

</body>

</html>
